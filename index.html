<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Chlorination Feedback - AP Communities</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
            line-height: 1.4;
        }

        .form-container {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid #4CAF50;
        }

        .section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 18px;
            text-align: center;
        }

        .question {
            margin-bottom: 25px;
        }

        .question-text {
            display: block;
            margin-bottom: 15px;
            font-weight: 500;
            color: #555;
            text-align: center;
            line-height: 1.5;
        }

        .lang-line {
            display: block;
            margin-bottom: 5px;
        }

        .emoji-rating {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .emoji-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px 12px;
            border: 3px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            min-width: 85px;
            flex: 0 0 calc(50% - 10px);
            max-width: 120px;
        }

        .emoji-option:nth-child(3) {
            flex: 0 0 100%;
            max-width: 140px;
        }

        .emoji-option:hover {
            border-color: #4CAF50;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
        }

        .emoji-option.selected {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .emoji {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .emoji-label {
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
        }

        .emoji-option input[type="radio"] {
            display: none;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .submit-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
        }

        .anonymous-note {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1565c0;
            text-align: center;
            line-height: 1.4;
        }

        .location-info {
            background: #f0f8f0;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #2e7d32;
            text-align: center;
            line-height: 1.4;
        }

        .location-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        .location-detected {
            background: #c8e6c9;
            color: #1b5e20;
        }

        .location-error {
            background: #ffcdd2;
            color: #c62828;
        }

        .location-loading {
            background: #fff3e0;
            color: #e65100;
        }

        .voice-note-section {
            background: #fff3e0;
            border: 2px solid #ffcc02;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            text-align: center;
        }

        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .voice-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        .voice-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .voice-btn.recording {
            background: #e53e3e;
            animation: pulse 1.5s infinite;
        }

        .voice-btn.playing {
            background: #38a169;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(229, 62, 62, 0); }
            100% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0); }
        }

        .voice-status {
            font-size: 14px;
            color: #666;
            margin: 10px 0;
            min-height: 20px;
        }

        .voice-status.recording {
            color: #e53e3e;
            font-weight: bold;
        }

        .voice-waveform {
            display: none;
            height: 50px;
            background: #f0f0f0;
            border-radius: 5px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .voice-waveform.active {
            display: block;
        }

        .wave-bar {
            display: inline-block;
            width: 3px;
            background: #ff6b35;
            margin: 0 1px;
            border-radius: 2px;
            animation: wave 1s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { height: 10px; }
            50% { height: 40px; }
        }

        .audio-player {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .audio-player.show {
            display: block;
        }

        .audio-player audio {
            width: 100%;
            height: 40px;
        }

        .voice-note-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            line-height: 1.4;
        }
            .container {
                margin: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .emoji-rating {
                gap: 10px;
                max-width: 300px;
            }
            
            .emoji-option {
                min-width: 70px;
                padding: 12px 8px;
                flex: 0 0 calc(50% - 8px);
                max-width: 100px;
            }
            
            .emoji-option:nth-child(3) {
                flex: 0 0 100%;
                max-width: 120px;
            }
            
            .emoji {
                font-size: 2em;
            }
            
            .emoji-label {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö∞ Water Quality Feedback</h1>
            <p>
                <span class="lang-line">‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§´‡•Ä‡§°‡§¨‡•à‡§ï</span>
                <span class="lang-line">‡∞®‡±Ä‡∞ü‡∞ø ‡∞®‡∞æ‡∞£‡±ç‡∞Ø‡∞§ ‡∞´‡±Ä‡∞°‡±ç‚Äå‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡±ç</span>
            </p>
        </div>

        <div class="form-container">
            <div class="anonymous-note">
                üîí <strong>Anonymous Feedback | ‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§´‡•Ä‡§°‡§¨‡•à‡§ï | ‡∞Ö‡∞®‡∞æ‡∞Æ‡∞ï ‡∞´‡±Ä‡∞°‡±ç‚Äå‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡±ç:</strong><br>
                This form is completely anonymous | ‡§Ø‡§π ‡§´‡•â‡§∞‡•ç‡§Æ ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§π‡•à | ‡∞à ‡∞´‡∞æ‡∞∞‡∞Æ‡±ç ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø‡∞ó‡∞æ ‡∞Ö‡∞®‡∞æ‡∞Æ‡∞ï‡∞Ç
            </div>

            <form id="feedbackForm">
                <div class="section">
                    <div class="question">
                        <label class="question-text">
                            <span class="lang-line"><strong>How are you feeling about the chlorinated water?</strong></span>
                            <span class="lang-line"><strong>‡§ï‡•ç‡§≤‡•ã‡§∞‡•Ä‡§®‡•á‡§∂‡§® ‡§ï‡•á ‡§™‡§æ‡§®‡•Ä ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§™ ‡§ï‡•à‡§∏‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?</strong></span>
                            <span class="lang-line"><strong>‡∞ï‡±ç‡∞≤‡±ã‡∞∞‡∞ø‡∞®‡±á‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞® ‡∞®‡±Ä‡∞ü‡∞ø ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞é‡∞≤‡∞æ ‡∞Ö‡∞®‡±Å‡∞≠‡∞µ‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å?</strong></span>
                        </label>
                        <div class="emoji-rating">
                            <div class="emoji-option" data-value="very-unhappy">
                                <input type="radio" name="feeling" value="very-unhappy" id="feeling-very-unhappy">
                                <div class="emoji">üò†</div>
                                <div class="emoji-label">Very Unhappy<br>‡§¨‡§π‡•Å‡§§ ‡§®‡§æ‡§ñ‡•Å‡§∂<br>‡∞ö‡∞æ‡∞≤‡∞æ ‡∞Ö‡∞∏‡∞Ç‡∞§‡±ã‡∞∑‡∞Ç</div>
                            </div>
                            <div class="emoji-option" data-value="unhappy">
                                <input type="radio" name="feeling" value="unhappy" id="feeling-unhappy">
                                <div class="emoji">üòû</div>
                                <div class="emoji-label">Unhappy<br>‡§®‡§æ‡§ñ‡•Å‡§∂<br>‡∞Ö‡∞∏‡∞Ç‡∞§‡±ã‡∞∑‡∞Ç</div>
                            </div>
                            <div class="emoji-option" data-value="neutral">
                                <input type="radio" name="feeling" value="neutral" id="feeling-neutral">
                                <div class="emoji">üòê</div>
                                <div class="emoji-label">Neutral<br>‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø<br>‡∞∏‡∞æ‡∞ß‡∞æ‡∞∞‡∞£</div>
                            </div>
                            <div class="emoji-option" data-value="happy">
                                <input type="radio" name="feeling" value="happy" id="feeling-happy">
                                <div class="emoji">üòä</div>
                                <div class="emoji-label">Happy<br>‡§ñ‡•Å‡§∂<br>‡∞∏‡∞Ç‡∞§‡±ã‡∞∑‡∞Ç</div>
                            </div>
                            <div class="emoji-option" data-value="very-happy">
                                <input type="radio" name="feeling" value="very-happy" id="feeling-very-happy">
                                <div class="emoji">üòÅ</div>
                                <div class="emoji-label">Very Happy<br>‡§¨‡§π‡•Å‡§§ ‡§ñ‡•Å‡§∂<br>‡∞ö‡∞æ‡∞≤‡∞æ ‡∞∏‡∞Ç‡∞§‡±ã‡∞∑‡∞Ç</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>
                        Feedback | ‡§´‡•Ä‡§°‡§¨‡•à‡§ï | ‡∞´‡±Ä‡∞°‡±ç‚Äå‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡±ç
                    </h3>
                    
                    <div class="question">
                        <label class="question-text">
                            <span class="lang-line">Any problems or suggestions?</span>
                            <span class="lang-line">‡§ï‡•ã‡§à ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ø‡§æ ‡§∏‡•Å‡§ù‡§æ‡§µ?</span>
                            <span class="lang-line">‡∞è‡∞µ‡±à‡∞®‡∞æ ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡±Å ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡±Ç‡∞ö‡∞®‡∞≤‡±Å?</span>
                        </label>
                        <textarea name="comments" placeholder="Please share any issues, suggestions, or additional comments... | ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ, ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç... | ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞è‡∞µ‡±à‡∞®‡∞æ ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡±Å, ‡∞∏‡±Ç‡∞ö‡∞®‡∞≤‡±Å ‡∞™‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø..."></textarea>
                        
                        <div class="voice-note-section">
                            <h4 style="margin-bottom: 10px; color: #e65100;">
                                üé§ Voice Note | ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡§Ç‡§¶‡•á‡§∂ | ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞®‡±ã‡∞ü‡±ç
                            </h4>
                            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                                Record your feedback in your own voice | ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§¶‡•á‡§Ç | ‡∞Æ‡±Ä ‡∞∏‡±ç‡∞µ‡∞Ç‡∞§ ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç‚Äå‡∞≤‡±ã ‡∞´‡±Ä‡∞°‡±ç‚Äå‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø
                            </p>
                            
                            <div class="voice-controls">
                                <button type="button" id="recordBtn" class="voice-btn">
                                    üé§ <span id="recordText">Start Recording | ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡•á‡§Ç | ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>
                                </button>
                                <button type="button" id="playBtn" class="voice-btn" disabled>
                                    ‚ñ∂Ô∏è <span>Play | ‡§ö‡§≤‡§æ‡§è‡§Ç | ‡∞™‡±ç‡∞≤‡±á ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>
                                </button>
                                <button type="button" id="deleteBtn" class="voice-btn" disabled>
                                    üóëÔ∏è <span>Delete | ‡§π‡§ü‡§æ‡§è‡§Ç | ‡∞°‡∞ø‡∞≤‡±Ä‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>
                                </button>
                            </div>
                            
                            <div id="voiceStatus" class="voice-status">
                                Ready to record | ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•ã ‡§§‡•à‡§Ø‡§æ‡§∞ | ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç
                            </div>
                            
                            <div id="waveform" class="voice-waveform">
                                <div class="wave-bar" style="animation-delay: 0s;"></div>
                                <div class="wave-bar" style="animation-delay: 0.1s;"></div>
                                <div class="wave-bar" style="animation-delay: 0.2s;"></div>
                                <div class="wave-bar" style="animation-delay: 0.3s;"></div>
                                <div class="wave-bar" style="animation-delay: 0.4s;"></div>
                                <div class="wave-bar" style="animation-delay: 0.5s;"></div>
                                <div class="wave-bar" style="animation-delay: 0.6s;"></div>
                                <div class="wave-bar" style="animation-delay: 0.7s;"></div>
                            </div>
                            
                            <div id="audioPlayer" class="audio-player">
                                <audio id="audioPlayback" controls></audio>
                            </div>
                            
                            <div class="voice-note-info">
                                üí° <strong>Tip:</strong> Speak clearly and mention your location<br>
                                ‡§∏‡•Å‡§ù‡§æ‡§µ: ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¨‡•ã‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§®‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§¨‡§§‡§æ‡§è‡§Ç<br>
                                ‡∞ö‡∞ø‡∞ü‡±ç‡∞ï‡∞æ: ‡∞∏‡±ç‡∞™‡∞∑‡±ç‡∞ü‡∞Ç‡∞ó‡∞æ ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞Ç‡∞°‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞Æ‡±Ä ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    Submit Feedback | ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§≠‡•á‡§ú‡•á‡§Ç | ‡∞´‡±Ä‡∞°‡±ç‚Äå‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡±ç ‡∞™‡∞Ç‡∞™‡∞Ç‡∞°‡∞ø
                </button>
            </form>

            <div class="location-info">
                üìç <strong>Location Detection | ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ó‡§æ‡§®‡§æ | ‡∞∏‡±ç‡∞•‡∞æ‡∞® ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞™‡±Å</strong><br>
                <span id="locationStatus" class="location-status location-loading">
                    Getting your location... | ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç... | ‡∞Æ‡±Ä ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞™‡±ä‡∞Ç‡∞¶‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Æ‡±Å...
                </span>
                <div id="locationDetails" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
            </div>

            <div class="success-message" id="successMessage">
                <h3>‚úÖ Thank you for your feedback!</h3>
                <p>
                    ‡§Ü‡§™‡§ï‡•á ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!<br>
                    ‡∞Æ‡±Ä ‡∞´‡±Ä‡∞°‡±ç‚Äå‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡±ç‚Äå‡∞ï‡±Å ‡∞ß‡∞®‡±ç‡∞Ø‡∞µ‡∞æ‡∞¶‡∞æ‡∞≤‡±Å!<br><br>
                    Your response has been recorded anonymously.<br>
                    ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¶‡§∞‡•ç‡§ú ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡•§<br>
                    ‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞§‡∞ø‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞® ‡∞Ö‡∞®‡∞æ‡∞Æ‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø‡•§
                </p>
            </div>
        </div>
    </div>

    <script>
        let userLocation = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordedAudioBlob = null;
        let isRecording = false;

        // Voice recording functionality
        async function initializeVoiceRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // MediaRecorder with better compatibility
                const options = { mimeType: 'audio/webm' };
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'audio/mp4';
                    if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                        options.mimeType = 'audio/wav';
                        if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                            options.mimeType = '';
                        }
                    }
                }
                
                mediaRecorder = new MediaRecorder(stream, options);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    recordedAudioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(recordedAudioBlob);
                    
                    // Enable play and delete buttons
                    document.getElementById('playBtn').disabled = false;
                    document.getElementById('deleteBtn').disabled = false;
                    
                    // Setup audio player
                    const audioPlayer = document.getElementById('audioPlayback');
                    audioPlayer.src = audioUrl;
                    document.getElementById('audioPlayer').classList.add('show');
                    
                    // Update status
                    document.getElementById('voiceStatus').textContent = 
                        'Recording saved! | ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§à! | ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡∞ø‡∞Ç‡∞ó‡±ç ‡∞∏‡±á‡∞µ‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø!';
                };
                
                console.log('Voice recording initialized successfully');
                return true;
                
            } catch (error) {
                console.error('Error accessing microphone:', error);
                document.getElementById('voiceStatus').textContent = 
                    'Microphone access denied | ‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§´‡•ã‡§® ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ | ‡∞Æ‡±à‡∞ï‡±ç‡∞∞‡±ã‡∞´‡±ã‡∞®‡±ç ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡±ç ‡∞®‡∞ø‡∞∞‡∞æ‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø';
                document.getElementById('recordBtn').disabled = true;
                return false;
            }
        }

        // Handle recording button
        document.getElementById('recordBtn').addEventListener('click', async function() {
            if (!mediaRecorder) {
                const initialized = await initializeVoiceRecording();
                if (!initialized) return;
            }
            
            if (!isRecording) {
                // Start recording
                audioChunks = [];
                mediaRecorder.start();
                isRecording = true;
                
                // Update UI
                this.classList.add('recording');
                document.getElementById('recordText').textContent = 'Stop Recording | ‡§∞‡•ã‡§ï‡•á‡§Ç | ‡∞Ü‡∞™‡∞Ç‡∞°‡∞ø';
                document.getElementById('voiceStatus').textContent = 'Recording... | ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à... | ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...';
                document.getElementById('voiceStatus').classList.add('recording');
                document.getElementById('waveform').classList.add('active');
                
                // Disable other buttons
                document.getElementById('playBtn').disabled = true;
                document.getElementById('deleteBtn').disabled = true;
                
            } else {
                // Stop recording
                mediaRecorder.stop();
                isRecording = false;
                
                // Update UI
                this.classList.remove('recording');
                document.getElementById('recordText').textContent = 'Start Recording | ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡•á‡§Ç | ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø';
                document.getElementById('voiceStatus').classList.remove('recording');
                document.getElementById('waveform').classList.remove('active');
            }
        });

        // Handle play button
        document.getElementById('playBtn').addEventListener('click', function() {
            const audioPlayer = document.getElementById('audioPlayback');
            
            if (audioPlayer.paused) {
                audioPlayer.play();
                this.classList.add('playing');
                this.innerHTML = '‚è∏Ô∏è <span>Pause | ‡§∞‡•ã‡§ï‡•á‡§Ç | ‡∞™‡∞æ‡∞ú‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>';
            } else {
                audioPlayer.pause();
                this.classList.remove('playing');
                this.innerHTML = '‚ñ∂Ô∏è <span>Play | ‡§ö‡§≤‡§æ‡§è‡§Ç | ‡∞™‡±ç‡∞≤‡±á ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>';
            }
        });

        // Handle audio playback end
        document.getElementById('audioPlayback').addEventListener('ended', function() {
            const playBtn = document.getElementById('playBtn');
            playBtn.classList.remove('playing');
            playBtn.innerHTML = '‚ñ∂Ô∏è <span>Play | ‡§ö‡§≤‡§æ‡§è‡§Ç | ‡∞™‡±ç‡∞≤‡±á ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>';
        });

        // Handle delete button
        document.getElementById('deleteBtn').addEventListener('click', function() {
            // Clear recorded audio
            recordedAudioBlob = null;
            audioChunks = [];
            
            // Reset UI
            document.getElementById('audioPlayer').classList.remove('show');
            document.getElementById('playBtn').disabled = true;
            document.getElementById('deleteBtn').disabled = true;
            document.getElementById('voiceStatus').textContent = 
                'Ready to record | ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•ã ‡§§‡•à‡§Ø‡§æ‡§∞ | ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç';
            
            // Reset play button
            const playBtn = document.getElementById('playBtn');
            playBtn.classList.remove('playing');
            playBtn.innerHTML = '‚ñ∂Ô∏è <span>Play | ‡§ö‡§≤‡§æ‡§è‡§Ç | ‡∞™‡±ç‡∞≤‡±á ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</span>';
        });

        // Convert audio blob to base64 for storage/transmission
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        // Get user's location automatically when page loads
        function getUserLocation() {
            const statusElement = document.getElementById('locationStatus');
            const detailsElement = document.getElementById('locationDetails');

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date().toISOString()
                        };

                        statusElement.textContent = 'Location detected ‚úì | ‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡§ø‡§≤ ‡§ó‡§Ø‡§æ ‚úì | ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø ‚úì';
                        statusElement.className = 'location-status location-detected';
                        
                        detailsElement.innerHTML = `
                            <strong>Coordinates:</strong> ${userLocation.latitude.toFixed(6)}, ${userLocation.longitude.toFixed(6)}<br>
                            <strong>Accuracy:</strong> ¬±${Math.round(userLocation.accuracy)}m<br>
                            <small>Location will be included with your feedback</small>
                        `;

                        // Try to get readable address
                        getReadableAddress(userLocation.latitude, userLocation.longitude);
                    },
                    function(error) {
                        let errorMessage = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location access denied | ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•Ä ‡§ó‡§à | ‡∞∏‡±ç‡∞•‡∞æ‡∞® ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡±ç ‡∞®‡∞ø‡∞∞‡∞æ‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location unavailable | ‡§∏‡•ç‡§•‡§æ‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç | ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞¶‡±Å';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location timeout | ‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ | ‡∞∏‡±ç‡∞•‡∞æ‡∞® ‡∞∏‡∞Æ‡∞Ø‡∞Ç ‡∞Æ‡±Å‡∞ó‡∞ø‡∞∏‡∞ø‡∞Ç‡∞¶‡∞ø';
                                break;
                        }
                        
                        statusElement.textContent = errorMessage;
                        statusElement.className = 'location-status location-error';
                        detailsElement.innerHTML = '<small>Feedback will be submitted without location</small>';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                statusElement.textContent = 'Location not supported | ‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç | ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å ‡∞≤‡±á‡∞¶‡±Å';
                statusElement.className = 'location-status location-error';
                detailsElement.innerHTML = '<small>Your device does not support location services</small>';
            }
        }

        // Get readable address from coordinates (optional)
        function getReadableAddress(lat, lng) {
            // Using OpenStreetMap Nominatim API for reverse geocoding (free)
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.display_name) {
                        const address = data.display_name;
                        const detailsElement = document.getElementById('locationDetails');
                        detailsElement.innerHTML += `<br><strong>Address:</strong> ${address}`;
                    }
                })
                .catch(error => {
                    console.log('Could not get readable address:', error);
                });
        }

        // Handle emoji rating selections
        document.querySelectorAll('.emoji-option').forEach(option => {
            option.addEventListener('click', function() {
                const radioInput = this.querySelector('input[type="radio"]');
                const groupName = radioInput.name;
                
                // Remove selected class from all options in this group
                document.querySelectorAll(`input[name="${groupName}"]`).forEach(input => {
                    input.closest('.emoji-option').classList.remove('selected');
                });
                
                // Add selected class to clicked option
                this.classList.add('selected');
                radioInput.checked = true;
            });
        });

        // Function to send data to Google Sheets
        function sendToGoogleSheets(data) {
            // FIXED: Added missing quote and removed semicolon
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyQqLKV7hiVawj6lVrNc9yxXwg_ABJNaAyEz2CvKi9MK2Il-5WfifTyZw1e3T5D5xU3/exec';
            
            console.log('Attempting to send data to Google Sheets:', data);
            
            const payload = {
                timestamp: data.timestamp,
                submissionId: data.submissionId,
                feeling: data.feeling || '',
                comments: data.comments || '',
                hasLocation: data.hasLocation,
                latitude: data.latitude,
                longitude: data.longitude,
                accuracy: data.accuracy
            };
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // FIXED: Changed from 'cors' to 'no-cors'
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(() => {
                console.log('‚úÖ Data sent to Google Sheets successfully');
            })
            .catch(error => {
                console.error('‚ùå Error sending to Google Sheets:', error);
            });
            
            console.log('Data ready for Google Sheets:', payload);
        }

        // Handle form submission - UPDATED with validation and debugging
        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('üìù Form submission started');
            
            // ADDED: Form validation
            const feelingSelected = document.querySelector('input[name="feeling"]:checked');
            if (!feelingSelected) {
                alert('Please select how you feel about the water before submitting!\n\n‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§™‡§æ‡§®‡•Ä ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§∞‡§æ‡§Ø ‡§¶‡•á‡§Ç!\n\n‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞¨‡±ç‡∞Æ‡∞ø‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞®‡±Ä‡∞ü‡∞ø ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Æ‡±Ä ‡∞Ö‡∞≠‡∞ø‡∞™‡±ç‡∞∞‡∞æ‡∞Ø‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø!');
                return;
            }
            
            // Collect form data
            const formData = new FormData(this);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            console.log('üìä Form data collected:', data);
            
            // Add timestamp and location data
            data.timestamp = new Date().toISOString();
            data.submissionId = 'FB_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Include location if available
            if (userLocation) {
                data.location = userLocation;
                data.hasLocation = true;
                data.latitude = userLocation.latitude;
                data.longitude = userLocation.longitude;
                data.accuracy = userLocation.accuracy;
                console.log('üìç Location data included');
            } else {
                data.hasLocation = false;
                data.latitude = '';
                data.longitude = '';
                data.accuracy = '';
                console.log('‚ùå No location data available');
            }
            
            console.log('üì§ Final data package:', data);
            
            // Include voice note if recorded
            if (recordedAudioBlob) {
                console.log('üé§ Voice note included');
                try {
                    const audioBase64 = await blobToBase64(recordedAudioBlob);
                    data.hasVoiceNote = true;
                    data.voiceNote = audioBase64;
                    data.voiceNoteSize = recordedAudioBlob.size;
                    data.voiceNoteDuration = document.getElementById('audioPlayback').duration || 0;
                } catch (error) {
                    console.error('Error processing voice note:', error);
                    data.hasVoiceNote = false;
                }
            } else {
                data.hasVoiceNote = false;
                console.log('‚ùå No voice note recorded');
            }
            
            // Send to Google Sheets
            sendToGoogleSheets(data);
            
            // Store locally as backup
            const existingFeedback = JSON.parse(localStorage.getItem('chlorinationFeedback') || '[]');
            existingFeedback.push(data);
            localStorage.setItem('chlorinationFeedback', JSON.stringify(existingFeedback));
            console.log('üíæ Data stored locally as backup');
            
            // Show success message
            document.querySelector('.form-container form').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            console.log('‚úÖ Success message displayed');
            
            // Reset form after 5 seconds for next user
            setTimeout(() => {
                this.reset();
                document.querySelectorAll('.emoji-option').forEach(option => {
                    option.classList.remove('selected');
                });
                document.querySelector('.form-container form').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
                console.log('üîÑ Form reset for next user');
            }, 5000);
        });

        // Initialize location detection when page loads
        document.addEventListener('DOMContentLoaded', function() {
            getUserLocation();
        });
    </script>
</body>
</html>
